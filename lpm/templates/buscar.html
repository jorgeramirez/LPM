<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:py="http://genshi.edgewall.org/"
      xmlns:xi="http://www.w3.org/2001/XInclude">
<py:def function="buscar">
<style>
    #templates { 
        display: none;
    }
</style>
<!--    <link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/base/jquery-ui.css" rel="stylesheet" type="text/css"/>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.5/jquery.min.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/jquery-ui.min.js"></script>
-->
<link href="${tg.url('/css/jquery-ui.css')}" rel="stylesheet" type="text/css"/>
<script src="${tg.url('/javascript/jquery-1.5.1.min.js')}"></script>
<script src="${tg.url('/javascript/jquery-ui-1.8.13.custom.min.js')}"></script>
<script type="text/javascript">

$(document).ready(function () {
    


    $('#form :button[name=add-filter]').live('click', function () {
        $('#form :input[name=cualquiera]').attr('disabled', true);
        $('#form :input[name=cualquiera]').val('');
    
        count = $('#form .filters').data('count');
        $('#form .filters').data('count', count + 1);
        
        $('#templates .filter.template').children().clone().appendTo('#form .filters')
            .data('count', count)
            .find('[name]').trigger('adjust-name');
    });
    
    $('#form :button[name^=remove-filter]').live('click', function () {
        $(this).parent('.filter').remove();
        count = $('#form .filters').data('count');
        $('#form .filters').data('count', count - 1);
        
        if(count - 1 == 0) {
            $('#form :input[name=cualquiera]').attr('disabled', false);
        }
            
    });
    
    $('#form select[name^=filter-type]').live('change', function () {
        template = $(this).find(':selected').attr('data-filter-template-name');
        if (template) {
            destination = $(this).next('span').children().remove().end();
            
            if(template == "fecha"){
                $('#templates .' + template + '.template').children().clone().appendTo(destination)
                    .find('[name]').andSelf().trigger('adjust-name');/*.datepicker({ altFormat: 'yy-mm-dd', buttonText: 'Elegir fecha' });*/
                $('.calendario').datepicker({ dateFormat: 'yy-mm-dd' });
                /*$('.calendario').datepicker( 'option', 'altFormat', 'yy-mm-dd' );*/
            } else if(template == "nada") {
                //saca el input que quedo colgado
                $(this).next('input').remove();
            
            }else{
                $('#templates .' + template + '.template').children().clone().appendTo(destination)
                    .find('[name]').andSelf().trigger('adjust-name');
            }
        }
    });
/*
    $(function() {
        $('#calendario').datepicker({ altFormat: 'yy-mm-dd', buttonText: 'Elegir fecha' });
    });
*/
    
    $('#form [name]').live('adjust-name', function (event) {
        count = $(this).parents('.filter').data('count');
        $(this).attr('name', $(this).attr('name') + '-' + count);
    });
  
    $('#templates .header_filtro').children().clone().appendTo('#form');
    $('#templates .form.template').children().clone().appendTo('#form');
    $('#form .filters').data('count', 0);
    
    //validaci√≥n para campos con solamente numeros enteros
    $('.solo_entero').live('keyup', function () {
        $(this).val($(this).val().replace(/[^0-9]/g, ''));

    });
});

</script>
<div>
    <div class="buscar">
    <div id="templates">
        <div class="header_filtro">
            <!--<span style="margin-top:5px; margin-left:40px; font-size:15;">En ${modelo}s</span>-->
            <input id="buscar_cualquiera" type="text" name="cualquiera" />
            <input id="buscar_boton" class="boton" type="submit" value="Buscar"/>    
        </div>
    
        <div class="form template">
            <div class="filters">
            </div>
            <div class="footer_filtro">
                <input  id="filtro_boton" type="button" name="add-filter" value="Agregar Filtro" />  
            </div>
        </div>
        <div class="filter template">
            <div class="filter">
                <input id="x_boton" type="button" name="remove-filter" value="x"/>
                <select name="filter-type">
                    <option value="" selected="selected" data-filter-template-name="nada">--- Seleccionar un filtro ---</option>
                    <py:for each="col in opciones">
                        <option value="$col" data-filter-template-name="${columnas[col]}">${opciones[col]}</option>
                    </py:for>
                </select>
                
                <span>
                </span>
            </div>
        </div>
        
        <div class="name template">
            <input type="text" name="name" />
        </div>
        
        <div class="texto template">
            <input type="text" name="texto" style="width:47%;" />
        </div>
        
        <div class="entero template">
            <input class="solo_entero" type="text" name="entero" style="width:47%;" />
        </div>
        
        <div class="fecha template">
            <div class="rango_fechas">De
            <input type="text" class="calendario" name="fecha" style="width:20%;"/>
            a
            <input type="text" class="calendario" name="fecha" style="width:20%;"/>
            </div>
        </div>

        <py:if test="defined('comboboxes')">
            <py:for each="column in comboboxes">
                <div class="combobox template">
                    <select name="combobox" style="width:47%;">
                        <option value="" selected="selected">--- Seleccionar ---</option>
                        <py:for each="opt in comboboxes[column]">
                            <option value="$opt">${opt}</option>
                        </py:for>
                    </select>
                </div>
            </py:for>
        </py:if>
        
    </div>
    
    <form id="form" method="post" action="${url_action}post_buscar/">
    </form>
    </div>
</div>
</py:def>
</html>
